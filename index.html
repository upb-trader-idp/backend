<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UPB Trader - Auth & Buy Test</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
      max-width: 500px;
    }
    input, button {
      width: 100%;
      padding: 0.75rem;
      margin: 0.5rem 0;
    }
    form {
      margin-bottom: 2rem;
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<h2>Login</h2>
<form id="login-form">
  <input type="text" id="login-username" placeholder="Username" required>
  <input type="password" id="login-password" placeholder="Password" required>
  <button type="submit">Login</button>
  <p id="login-status"></p>
</form>

<h2>Buy Stock</h2>
<form id="buy-form">
  <input type="text" id="symbol" placeholder="Symbol (e.g. AAPL)" required>
  <input type="number" id="quantity" placeholder="Quantity" required>
  <input type="number" step="0.01" id="price" placeholder="Price" required>
  <input type="text" id="flag" placeholder="Flag (e.g. long)" required>
  <button type="submit">Buy</button>
  <p id="buy-status"></p>
</form>

<script>
  let token = "";

  const loginForm = document.getElementById("login-form");
  const buyForm = document.getElementById("buy-form");
  const loginStatus = document.getElementById("login-status");
  const buyStatus = document.getElementById("buy-status");

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    loginStatus.textContent = "Logging in...";

    const res = await fetch("http://localhost:8000/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username: document.getElementById("login-username").value,
        password: document.getElementById("login-password").value
      })
    });

    const data = await res.json();
    if (res.ok) {
      token = data.access_token;
      loginStatus.textContent = "Logged in ✅";
      loginStatus.style.color = "green";
    } else {
      loginStatus.textContent = data.detail || "Login failed ❌";
      loginStatus.style.color = "red";
    }
  });

  buyForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    buyStatus.textContent = "Submitting trade...";

    const res = await fetch("http://localhost:8001/trade", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({
        symbol: document.getElementById("symbol").value,
        quantity: parseInt(document.getElementById("quantity").value),
        price: parseFloat(document.getElementById("price").value),
        action: "buy",
        flag: document.getElementById("flag").value
      })
    });

    const data = await res.json();
    if (res.ok) {
      buyStatus.textContent = "Trade saved ✅ ID: " + data.trade_id;
      buyStatus.style.color = "green";
    } else {
      buyStatus.textContent = data.detail || "Trade failed ❌";
      buyStatus.style.color = "red";
    }
  });
</script>

</body>
</html>
